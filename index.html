<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zouk Training Metronome</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f4f4f4;margin:0;padding:0;display:flex;justify-content:center;align-items:center;height:100vh;}
  .container{background:#fff;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.1);padding:24px;width:320px;text-align:center;}
  h1{font-size:1.6rem;margin:0 0 12px;}
  .bpm-control{display:flex;align-items:center;justify-content:center;margin:12px 0;}
  .bpm-control input[type=number]{width:60px;margin-left:8px;text-align:center;}
  .bpm-control input[type=range]{width:200px;}
  .beat{font-size:4rem;color:#444;margin:12px 0;}
  button{background:#5900ad;color:#fff200;border:none;padding:10px 20px;border-radius:4px;font-size:2rem;cursor:pointer;font-family:Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;}
  button.stop{background:#0080bb;}
  button:focus{outline:none;}
</style>
</head>
<body>

<div class="container">
  <h1>Zouk Training Metronome</h1>

  <!-- BPM controls -->
  <div class="bpm-control">
    <label for="bpm">BPM:</label>
    <input type="range" id="bpm" min="40" max="80" value="60">
    <input type="number" id="bpmNum" min="40" max="80" value="60">
  </div>

  <!-- Dictionary selector -->
  <div class="bpm-control">
    <label for="dictSelect">Training:</label>
    <select id="dictSelect">
      <option value="colors" selected>Footwork</option>
      <option value="numbers">Head Motion</option>
      <option value="names">Insanity</option>
    </select>
  </div>

  <!-- Beat display & start/stop -->
  <div class="beat" id="beatDisplay">1</div>
  <button id="toggleBtn">Zouk It!</button>
</div>

<script>
/* ───── 1️⃣  Audio – short click oscillator ──────── */
const AudioContext = window.AudioContext || window.webkitAudioContext;
const ctx = new AudioContext();
let currentOsc = null;

function playClick(isFirstBeat) {
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();

  osc.type = 'square';
  osc.frequency.setValueAtTime(isFirstBeat ? 1500 : 800, ctx.currentTime);
  gain.gain.setValueAtTime(0.3, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);

  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start(ctx.currentTime);
  osc.stop(ctx.currentTime + 0.05);

  currentOsc = osc;
}

/* ───── 2️⃣  Dictionaries for random phrases ──────── */
const dictionaries = {
  colors: ["", "basic", "ladder all", "veeduh jeena", "veeduh jeena 1 80", "basic in place"], // footwork cues
  numbers: ["", "clockwise asynchronous", "clockwise synchronous", "counterclockwise synchronous", "counterclockwise asynchronous", "wiggle wiggle wiggle"],     // head motion cues
  names: ["", "basic in place", "side basic", "linear basic", "pivot", "bonus", "boomerang", "hawool"]   // insanity cues
};

let currentDict = "colors";
let phrases = dictionaries[currentDict];
let lastPhrase = null;

/* Random phrase picker – never repeats the same phrase consecutively */
function pickPhrase() {
  if (!phrases.length) return "";
  let attempt = 0;
  const maxAttempts = 10;
  let chosen;
  do {
    chosen = phrases[Math.floor(Math.random() * phrases.length)];
    attempt++;
  } while (chosen === lastPhrase && attempt < maxAttempts);
  lastPhrase = chosen;
  return chosen;
}

/* Speak helper */
function speak(text) {
  if (!text) return;               // empty string → say nothing
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(text);
  window.speechSynthesis.speak(utterance);
}

/* ───── 3️⃣  UI & state ──────── */
let isRunning = false;
let bpm = 60;
let beat = 0;
let intervalId = null;

const bpmSlider = document.getElementById('bpm');
const bpmInput  = document.getElementById('bpmNum');
const beatDisp  = document.getElementById('beatDisplay');
const toggleBtn = document.getElementById('toggleBtn');
const dictSelect = document.getElementById('dictSelect');

bpmSlider.addEventListener('input', e => {
  bpm = +e.target.value;
  bpmInput.value = bpm;
});
bpmInput.addEventListener('input', e => {
  let val = +e.target.value;
  if (val < 40) val = 40;
  if (val > 80) val = 80;
  bpm = val;
  bpmSlider.value = val;
});

/* Dictionary change handler */
dictSelect.addEventListener('change', e => {
  currentDict = e.target.value;
  phrases = dictionaries[currentDict];
  lastPhrase = null;               // reset to avoid immediate repeat
});

/* ───── 4️⃣  Start / Stop logic ──────── */
function startMetronome() {
  if (ctx.state === 'suspended') ctx.resume();   // iOS/Android

  isRunning = true;
  beat = 0;
  beatDisp.textContent = '1';
  toggleBtn.textContent = 'Stop';
  toggleBtn.classList.add('stop');

  playClick(true);   // first beat click (higher pitch)

  intervalId = setInterval(() => {
    beat = (beat + 1) % 4;
    beatDisp.textContent = (beat + 1).toString();
    playClick(beat === 0);   // higher pitch on beat 1

    if (beat === 2) {        // third beat
      const phrase = pickPhrase();
      speak(phrase);
    }
  }, 60000 / bpm);
}

function stopMetronome() {
  isRunning = false;
  if (intervalId) clearInterval(intervalId);
  intervalId = null;
  toggleBtn.textContent = 'Zouk It!';
  toggleBtn.classList.remove('stop');

  if (currentOsc) { currentOsc.stop(); currentOsc = null; }
  window.speechSynthesis.cancel();
}

toggleBtn.addEventListener('click', () => {
  if (!isRunning) startMetronome();
  else stopMetronome();
});

/* ───── 5️⃣  Touch‑friendly (mobile) ──────── */
document.body.addEventListener('touchstart', () => {
  if (ctx.state === 'suspended') ctx.resume();
});
</script>
</body>
</html>
